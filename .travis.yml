language: node_js
node_js: 13
os: linux

install:
  - npm install -g gulp-cli
  - npm install

jobs:
  include:
    - stage: "Build"
      name: "Run ESLint"
      script: node_modules/.bin/eslint src/js/*.js

    - stage: "Build"
      name: "Run Gulp"
      script: gulp

    - stage: "Deploy to GitHub"
      if: tag IS present
      name: "Deploy"
      script: gulp
      before_deploy:
        - export CLEAN_VERSION=${TRAVIS_TAG//v/}
        - sed -i.bak "s/#APPVERSION#/$CLEAN_VERSION/" build/*.php
        - rm build/*.bak
        - export ZIP_FILENAME="np2-wallboard-${TRAVIS_TAG}"
        - mkdir $ZIP_FILENAME
        - cp README.md LICENSE $ZIP_FILENAME
        - mv build ${ZIP_FILENAME}/public
        - zip -qr ${ZIP_FILENAME}.zip $ZIP_FILENAME
      deploy:
        provider: releases
        token:
          secure: "c21xBuA9Z0SrK61czhSKIb41zuZBrx0Sx1GgRieqDNpEdatYCEQuxPgNlN+njNpPM6GLMGg5jYOFcMdHK0Gn/IX7n8kjFdvV51HY/JcWvyhjdZTm1RTvWM4cG8lIZMW8snQ6xub0iOHiAO2ChPoNqNwoNJQTj+cT+88A3srLBL7/NFGjKKwfSDqwzk5kC3vomuPRxWOaR9HXotYP6AliZB0c1Kjn0s2v86C27ihtSQUmPFrbbW7/m5Qr+c9TlKDVA6+MLLo/R2GvL24vRhxTTlNPFgyKP8tXweOw+iAFDjDfLZsGg54Rw/JfGORZbiHQYEGEri4mtu1e0ckqhOrTj9uGVtNq5pUllCE8QJhrRpvFcHn/MDBUo5YN7obqJujU65XpZ7ADU0M//jBsxeJd/+/e+vvNS4dNNH/77YRq3TBEJrr4g9WubLXhkoGuApkBIhm5uGP/QH8foyGvkUweoJR8y97FstLNAIsk7mawTWu/QjuZQhIQQqqLMObyk8j0Dea419guzVw+ofqWsHM0NsbAFUqzMpIVsl4WVYx8Y0nyWRx51/zFXAIX9zqQEwW87TvJXu/tN7QNa0HDyF31gD9rkOc0Q41yxoA1pujsy19E+79+iGgrQavTsZodwInJgFmHlC4NY55kQnWFKJP+ZyoGVJyQq1puW0Y0SQpzmm8="
        file: "${ZIP_FILENAME}.zip"
        name: "$TRAVIS_TAG"
        skip_cleanup: true
        draft: true
        overwrite: true
        on:
          tags: true
