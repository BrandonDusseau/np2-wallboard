language: node_js
node_js:
  - 13

install:
  - npm install -g gulp-cli
  - npm install
  - gem install compass

script: gulp

before_deploy:
  - export CLEAN_VERSION=${TRAVIS_TAG//v/}
  - sed -ibak "s/#APPVERSION#/$CLEAN_VERSION/" build/*.php
  - export ZIP_FILENAME="np2-wallboard-${TRAVIS_TAG}"
  - mkdir $ZIP_FILENAME
  - cp README.md LICENSE $ZIP_FILENAME
  - mv build ${ZIP_FILENAME}/public
  - zip -qr ${ZIP_FILENAME}.zip $ZIP_FILENAME

deploy:
  provider: releases
  api_key:
    secure: "N+jmcggRX7BRjCi6WXG6b5nwtH4EOfcuiNoqdjowrWx7NJbzbtSYNr1GiIYRORIW+ntu2xtnFJVimXpqtNS3YyjXkjH6xD77Bc7A1Hll4Jn3LKSd5VGic6TLgUVMGWd9aM0YEMI0R3UyjHuo0UvELYAGz9tBhSHFeRLQ780Yfc5i0rTll1tiLKeC2qJnxEbzIw4f0N2rOeYtu9xz494uR1zsuxMCotGF/Wks64f6Jla+WVEh5sZQwlVq/YQcPi69Bf1KeGO2WJ3T42X4y/rGPOEnZ3LoP42ptIaI74K5KyfajjUrvcerxCfFfz163o6oKNak5W7ggzks+Z3d/zK1WdapioLKW3CIePHm0NlpxVrSeFGkjB8OzsJDp+29Rq04SWAbf0AWjv1BR4ZdPqAX33Colag0CfN4jsXo3XvIkMMjl3zcO9m/vd3DiY+RKc9GfnkPOp2Iw5Ip+B16Q52mDYYyppOK1n3rU6CFzYLLe7nm0bCwkn8ePwHFQwC4IT+Pwq7yhJqPl7dvmZqzU+noQkzIfyYonjNkR9IiVniEyzZMH/J0WWTq+v3vUwpYss31OTA1Iz0r+HHRLjLlSGCPSjUKr39ts6SsKaw4Spr4XKTt8hqtFPhE5AcvewvQxND175lL8xUWhscAoLFKhnwQ2Bq8tlev2pzIGWT8sGyJkgI="
  file: "${ZIP_FILENAME}.zip"
  skip_cleanup: true
  draft: true
  overwrite: true
  on:
    tags: true
